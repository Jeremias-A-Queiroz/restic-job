# restic-job

> A robust Bash wrapper for Restic automation via Rclone, featuring structured logging and a serverless, static HTML/JS dashboard for backup telemetry.

![License](https://img.shields.io/badge/license-GPLv3-blue.svg)
![Bash](https://img.shields.io/badge/language-bash-red.svg)
![Restic](https://img.shields.io/badge/backend-restic-green.svg)

## Overview

**restic-job** is an automation suite designed to simplify the management of Restic backups, specifically targeting remote storage backends (like Hetzner Storage Box) via Rclone.

Beyond standard backup execution, it focuses on **observability**: generating detailed JSON telemetry that powers a lightweight, "Industrial Phosphor" themed dashboard—no database or backend server required.

## Features

*   **Automation Wrapper:** Simplifies =restic backup=, =forget=, =prune=, and =check= commands.
*   **Structured Telemetry:** Exports =snapshots.json= and =stats.json= after every run.
*   **Static Dashboard:** A single-file =index.html= dashboard using Chart.js to visualize:
    *   Incremental data added (last 7 runs).
    *   Storage distribution by tag (e.g., Documents vs Music).
    *   Global repository statistics.
    *   Searchable/Scrollable snapshot history.
*   **Theme:** "InfraLinux Phosphor" — A high-contrast, dark-mode aesthetic designed for legibility.

## Dashboard Preview

The dashboard consumes the local JSON files generated by the script. It uses **Chart.js** to render metrics without external tracking or dependencies (other than the CDN for the library).

*   **Incremental Growth:** Prevents "infinite scale" issues by focusing on recent deltas.
*   **Visual Stability:** Fixed-height containers prevent layout shifts during rendering.

## Prerequisites

*   =bash=
*   =restic= (>= 0.14.0 recommended)
*   =rclone=
*   =jq= (for JSON processing)

## Installation

1.  Clone the repository:
    ```bash
    git clone https://github.com/YOUR_USERNAME/restic-job.git
    cd restic-job
    ```

2.  Ensure the script is executable:
    ```bash
    chmod +x restic-job
    ```

## Usage

### 1. Configuration
Set up your environment variables (usually in a =.env= file or exported in your shell profile):

```bash
export RESTIC_REPOSITORY="rclone:hetzner:backup/repo"
export RESTIC_PASSWORD_FILE="/path/to/passfile"
# Optional Rclone config path
export RCLONE_CONFIG="/path/to/rclone.conf"
```

### 2. Manual Execution

```bash
./restic-job backup
```

This command will:
1.  Initialize the repo (if needed).
2.  Perform the backup based on your file list.
3.  Apply retention policies (=forget= & =prune=).
4.  Generate/Update =snapshots.json= and =stats.json=.

### 3. Viewing the Dashboard
Simply open =index.html= in your web browser. Ensure =snapshots.json= and =stats.json= are in the same directory.

```bash
firefox index.html
```

## Automation (Cron)

Example crontab entry for daily backups at 02:00 AM:

```cron
0 2 * * * /home/user/src/restic-job/restic-job >> /var/log/restic-job.log 2>&1
```

## License

Distributed under the GNU General Public License v3.0. See =LICENSE= for more information.
